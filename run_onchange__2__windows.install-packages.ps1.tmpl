{{ if eq .chezmoi.os "windows" -}}

# FILEHASH ********************************************************************
# *****************************************************************************

# by embedding the file hash into this template, chezmoi will only detect
# changes if the hashed file changes. This will prevent unnecessarily running
# the script when the target file hasn't changed.

$fileHash = CertUtil -hashfile "$HOME/.local/share/.chezmoidata/packages.yaml" SHA256

# SCRIPT **********************************************************************
# *****************************************************************************

{{ range .packages.windows.winget -}}
    echo "- Checking WinGet for {{ . }}..."
    winget install {{ . }}
{{ end -}}

{{ range .packages.windows.choco -}}
    echo "- Checking Chocolatey for {{ . }}..."
    choco install {{ . }}
{{ end }}

{{ range .packages.global.uv -}}
    echo "- Checking UV for {{ . }} ..."
    uv tool install {{ . }}
{{ end }}

# on windows, nvm doesn't become available to the user without fresh terminal
if (!(Get-Command 'npm' -errorAction SilentlyContinue)) {
    echo "Configuring NVMforWindows for the first time..."
    Start-Process -FilePath powershell -ArgumentList "-Command", "nvm install latest; nvm use latest;{{ range .packages.global.npm -}}echo '- Checking NPM for {{ . }} ...'; npm install {{ . }}{{ end }}" -Verb RunAs -Wait
} else {
    {{ range .packages.global.npm -}}
        echo "- Checking NPM for {{ . }} ..."
        npm install {{ . }}
    {{ end }}
}

{{ range .packages.windows.commands -}}
{{ . }}
{{ end -}}

echo ""
echo "Please restart your terminal process to refresh your path"

{{ end -}}
